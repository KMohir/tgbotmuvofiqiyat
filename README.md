# Описание Telegram-бота для рассылки обучающих видео

## Общая логика работы
Бот автоматически рассылает обучающие видео в Telegram-группы по индивидуальному расписанию и настройкам. Управление ботом и настройками осуществляется через команды, доступные администраторам и супер-администраторам.

---

## Роли пользователей
- **Супер-админы** — только из переменной окружения `.env` (ADMINS=5657091547,5310261745 и т.д.), их нельзя добавить или удалить через команды, только изменить в файле и перезапустить бота.
- **Обычные админы** — хранятся в базе данных, их может добавлять/удалять только супер-админ через команды `/add_admin` и `/remove_admin`.
- **Пользователи** — все остальные, могут только получать видео и использовать базовые команды.

---

## Логика рассылки видео
- Видео отправляются в группы по расписанию, с учётом выбранных курсов (Centris Towers, Golden Lake) и выбранного для каждого курса сезона. Для каждого курса рассылка начинается с первого непросмотренного видео выбранного сезона.
- **Centris Towers (centris):**
  - 1-й сезон — видео отправляются в 08:00 и 20:00 (Asia/Tashkent).
  - Остальные сезоны — только в 08:00 (Asia/Tashkent).
- **Golden Lake:**
  - Если выбран только Golden Lake — видео отправляются в 08:00 (Asia/Tashkent).
  - Если выбран вместе с Centris Towers — видео отправляются в 11:00 (Asia/Tashkent).
- Если оба потока включены — оба расписания работают параллельно.
- За один запуск отправляется только одно непросмотренное видео.
- После отправки видео оно отмечается как просмотренное для этой группы.

---

## Работа с просмотренными видео
- Для каждой группы ведётся список просмотренных видео.
- Бот всегда ищет первое непросмотренное видео из выбранного сезона и отправляет его.
- Если все видео просмотрены — рассылка для этой группы останавливается до сброса прогресса.

---

## FSM (машина состояний)
- FSM используется для управления состояниями пользователя (например, при регистрации, настройках и т.д.).
- Любой админ или супер-админ может сбросить состояние FSM командой `/start` (в группе или личке).
- Все попытки сброса и сам факт сброса логируются.

---

## Работа с базой данных
- Бот использует PostgreSQL (через библиотеку `psycopg2`).
- Все данные о группах, видео, сезонах, администраторах и просмотренных видео хранятся в базе.

---

## Логирование
- Все ключевые действия (отправка видео, сброс FSM, админские команды) и ошибки записываются в лог-файл для диагностики.

---

## Описание всех команд

### Пользовательские команды
| Команда                | Описание                                                                                   |
|------------------------|--------------------------------------------------------------------------------------------|
| `/start`               | Сброс FSM (машины состояний) для пользователя или группы.                                  |
| `/help`                | Получить справку по командам и возможностям бота.                                          |
| `/support`             | Связаться с поддержкой (отправить сообщение админам/супер-админу).                         |
| `/language`            | Выбрать язык интерфейса (если реализовано).                                                |

### Команды для админов и супер-админов
| Команда                | Кто может использовать | Описание                                                                                   |
|------------------------|-----------------------|--------------------------------------------------------------------------------------------|
| `/add_admin`           | Только супер-админ    | Добавить нового администратора по ID.                                                      |
| `/remove_admin`        | Только супер-админ    | Удалить администратора по ID.                                                              |
| `/list_admins`         | Админ, супер-админ    | Показать список всех обычных администраторов из базы.                                      |
| `/set_season`          | Админ, супер-админ    | Выбрать сезон для группы (например, 1-й или 2-й).                                          |
| `/set_start_video`     | Админ, супер-админ    | Установить стартовое видео для рассылки в группе.                                          |
| `/reset_progress`      | Админ, супер-админ    | Сбросить прогресс просмотра видео для группы (начать рассылку заново).                     |
| `/add_video`           | Админ, супер-админ    | Добавить новое видео в выбранный сезон.                                                    |
| `/add_season`          | Админ, супер-админ    | Добавить новый сезон (например, для нового потока обучения).                               |
| `/video_status`        | Админ, супер-админ    | Показать статус рассылки видео в группе (какие просмотрены, какое следующее).              |
| `/schedule_info`       | Админ, супер-админ    | Показать текущее расписание рассылки для группы.                                           |

---

## Примеры работы команд
- **/add_admin 123456789** — добавить пользователя с ID 123456789 в список обычных админов (только супер-админ может выполнять).
- **/remove_admin 123456789** — удалить пользователя с ID 123456789 из списка обычных админов (только супер-админ).
- **/list_admins** — показать всех обычных админов из базы.
- **/set_group_video centris 2** — установить для группы 2-й сезон Centris Towers.
- **/set_group_video golden 1** — установить для группы 1-й сезон Golden Lake.
- **/set_group_video both 2 1** — установить для группы 2-й сезон Centris Towers и 1-й сезон Golden Lake.
- **/reset_progress** — сбросить прогресс — все видео снова будут считаться непросмотренными, рассылка начнётся с начала.
- **/video_status** — показать, какие видео уже отправлены, какое будет следующим.

---

## Права и роли
- **Супер-админ** — только из `.env`, может добавлять/удалять обычных админов, имеет полный доступ.
- **Обычный админ** — добавляется супер-админом, может управлять настройками групп, но не может добавлять/удалять других админов.
- **Пользователи** — могут только получать видео и использовать базовые команды.

---

## Работа с базой данных
- Все данные о группах, видео, сезонах, администраторах и просмотренных видео хранятся в PostgreSQL.
- Для тестов можно быстро переключиться на SQLite (оставлен комментарий в коде).

---

## Логирование
- Все ключевые действия (отправка видео, сброс FSM, админские команды) и ошибки записываются в лог-файл для диагностики.

---

## Прочие функции
- Можно добавлять новые сезоны и видео через команды.
- Можно сбрасывать прогресс группы.
- Все лишние времена рассылки удалены — остались только нужные по ТЗ.

---

## Схема работы команд и ролей

```
Пользователь:
  /start, /help, /support, /language
Обычный админ:
  /set_season, /set_start_video, /reset_progress, /add_video, /add_season, /video_status, /schedule_info, /list_admins
Супер-админ:
  /add_admin, /remove_admin, /list_admins (и все команды обычных админов)
```

---

Если нужна расшифровка какой-то команды или логики — обратитесь к разработчику или в поддержку.
